<!-- BOE Subastas Widget Compacto -->
<div id="boeWidget" style="margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3 style="margin: 0; font-size: 18px;">ğŸ  BOE Subastas - Rivas Vaciamadrid</h3>
        <div>
            <button onclick="boeExecuteScraper()" style="background: white; color: #667eea; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-right: 5px;">ğŸš€ Ejecutar</button>
            <button onclick="boeRefreshData()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 8px 15px; border-radius: 5px; cursor: pointer;">ğŸ”„</button>
        </div>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
        <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; text-align: center;">
            <div style="font-size: 11px; opacity: 0.9;">TOTAL SUBASTAS</div>
            <div id="boeTotalSubastas" style="font-size: 24px; font-weight: bold; margin: 5px 0;">-</div>
        </div>
        <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; text-align: center;">
            <div style="font-size: 11px; opacity: 0.9;">ÃšLTIMA EJECUCIÃ“N</div>
            <div id="boeUltimaEjecucion" style="font-size: 16px; font-weight: bold; margin: 5px 0;">-</div>
        </div>
        <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; text-align: center;">
            <div style="font-size: 11px; opacity: 0.9;">NUEVAS HOY</div>
            <div id="boeNuevasHoy" style="font-size: 24px; font-weight: bold; margin: 5px 0;">-</div>
        </div>
        <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; text-align: center;">
            <div style="font-size: 11px; opacity: 0.9;">ESTADO</div>
            <div id="boeEstado" style="font-size: 24px; margin: 5px 0;">â³</div>
        </div>
    </div>
    <div id="boeMessage" style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.2); border-radius: 5px; font-size: 13px; display: none;"></div>
</div>

<script>
const BOE_API_URL = 'https://boe-subastas-scraper-production.up.railway.app';

async function boeLoadData() {
    try {
        const [statsRes, runsRes] = await Promise.all([
            fetch(`${BOE_API_URL}/api/stats`),
            fetch(`${BOE_API_URL}/api/runs`)
        ]);
        
        if (statsRes.ok) {
            const stats = await statsRes.json();
            document.getElementById('boeTotalSubastas').textContent = stats.data?.total_subastas || 0;
            document.getElementById('boeNuevasHoy').textContent = stats.data?.nuevas_hoy || 0;
        }
        
        if (runsRes.ok) {
            const runs = await runsRes.json();
            if (runs.data && runs.data.length > 0) {
                const lastRun = runs.data[0];
                const time = new Date(lastRun.end_time).toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'});
                document.getElementById('boeUltimaEjecucion').textContent = time;
                document.getElementById('boeEstado').textContent = lastRun.status === 'success' ? 'âœ…' : 'âŒ';
            }
        }
    } catch (error) {
        console.error('Error loading BOE data:', error);
    }
}

async function boeExecuteScraper() {
    const btn = event.target;
    const msg = document.getElementById('boeMessage');
    btn.disabled = true;
    btn.textContent = 'â³ Ejecutando...';
    msg.style.display = 'block';
    msg.textContent = 'â³ Scraper ejecutÃ¡ndose...';
    
    try {
        const response = await fetch(`${BOE_API_URL}/api/scrape`);
        const result = await response.json();
        
        if (result.success) {
            msg.textContent = 'âœ… Scraper ejecutado correctamente';
            setTimeout(() => boeLoadData(), 3000);
        } else {
            msg.textContent = 'âŒ Error: ' + result.error;
        }
    } catch (error) {
        msg.textContent = 'âŒ Error de conexiÃ³n';
    } finally {
        btn.disabled = false;
        btn.textContent = 'ğŸš€ Ejecutar';
        setTimeout(() => { msg.style.display = 'none'; }, 5000);
    }
}

function boeRefreshData() {
    boeLoadData();
    const msg = document.getElementById('boeMessage');
    msg.style.display = 'block';
    msg.textContent = 'ğŸ”„ Datos actualizados';
    setTimeout(() => { msg.style.display = 'none'; }, 2000);
}

// Cargar datos al inicio
boeLoadData();

// Auto-refresh cada 2 minutos
setInterval(boeLoadData, 120000);
</script>
